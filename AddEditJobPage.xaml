<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="PhotoJobApp.AddEditJobPage"
             Title="Add/Edit Job">

    <ScrollView>
        <StackLayout Padding="20" Spacing="15">
            <!-- Job Type Selection -->
            <Label Text="Job Type *" Style="{StaticResource SubHeadline}"/>
            <Picker x:Name="JobTypePicker" 
                    Title="Select job type" 
                    SelectedIndexChanged="OnJobTypeChanged"/>

            <!-- Title -->
            <Label Text="Job Title *" Style="{StaticResource SubHeadline}"/>
            <Entry x:Name="TitleEntry" Placeholder="Enter job title" Text="{Binding Job.Title}"/>

            <!-- Description -->
            <Label Text="Description" Style="{StaticResource SubHeadline}"/>
            <Editor x:Name="DescriptionEditor" Placeholder="Enter job description" 
                    Text="{Binding Job.Description}" HeightRequest="80"/>

            <!-- Client Information - Only show if job type has client info enabled -->
            <StackLayout x:Name="ClientInfoSection" IsVisible="False">
                <Label Text="Client Information" Style="{StaticResource SubHeadline}"/>
                <Entry x:Name="ClientNameEntry" Placeholder="Client name *" Text="{Binding Job.ClientName}"/>
                <Entry x:Name="ClientPhoneEntry" Placeholder="Phone number" Text="{Binding Job.ClientPhone}" Keyboard="Telephone"/>
                <Entry x:Name="ClientEmailEntry" Placeholder="Email address" Text="{Binding Job.ClientEmail}" Keyboard="Email"/>
            </StackLayout>

            <!-- Price - Only show if job type has pricing enabled -->
            <StackLayout x:Name="PriceSection" IsVisible="False">
                <Label Text="Price *" Style="{StaticResource SubHeadline}"/>
                <Entry x:Name="PriceEntry" Placeholder="0.00" Text="{Binding Job.Price}" Keyboard="Numeric"/>
            </StackLayout>

            <!-- Status - Only show if job type has status enabled -->
            <StackLayout x:Name="StatusSection" IsVisible="False">
                <Label Text="Status *" Style="{StaticResource SubHeadline}"/>
                <Picker x:Name="StatusPicker" Title="Select status" />
            </StackLayout>

            <!-- Due Date - Only show if job type has due date enabled -->
            <StackLayout x:Name="DueDateSection" IsVisible="False">
                <Label Text="Due Date" Style="{StaticResource SubHeadline}"/>
                <DatePicker x:Name="DueDatePicker" Date="{Binding Job.DueDate}"/>
            </StackLayout>

            <!-- Location - Only show if job type has location enabled -->
            <StackLayout x:Name="LocationSection" IsVisible="False">
                <Label Text="Location" Style="{StaticResource SubHeadline}"/>
                <Entry x:Name="LocationEntry" Placeholder="Job location" Text="{Binding Job.Location}"/>
            </StackLayout>

            <!-- Photos - Only show if job type has photos enabled -->
            <StackLayout x:Name="PhotosSection" IsVisible="False">
                <Label Text="Photos" Style="{StaticResource SubHeadline}"/>
                <Frame Padding="15" CornerRadius="10" BackgroundColor="LightGray">
                    <StackLayout>
                        <Button Text="ðŸ“· Add Photo (Camera/Gallery)" 
                                Clicked="OnAddPhotoClicked"
                                BackgroundColor="{StaticResource Primary}"
                                TextColor="White"
                                CornerRadius="5"/>
                        
                        <!-- Photo Collection View - Only show when photos exist -->
                        <CollectionView x:Name="PhotosCollectionView" 
                                       ItemsSource="{Binding Photos}"
                                       HeightRequest="200"
                                       Margin="0,10,0,0"
                                       IsVisible="{Binding Photos.Count, Converter={StaticResource IntToBoolConverter}}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Frame Margin="5" Padding="5" CornerRadius="5" BackgroundColor="White">
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Image Grid.Column="0" Source="{Binding}" HeightRequest="80" Aspect="AspectFill"/>
                                            <Button Grid.Column="1" Text="âŒ" 
                                                    Clicked="OnRemovePhotoClicked" 
                                                    CommandParameter="{Binding}"
                                                    BackgroundColor="Red"
                                                    TextColor="White"
                                                    WidthRequest="30"
                                                    HeightRequest="30"
                                                    CornerRadius="15"/>
                                        </Grid>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                        
                        <!-- No Photos Message - Show when no photos exist -->
                        <Label Text="No photos added yet. Tap 'Add Photo' to get started."
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               TextColor="Gray"
                               Margin="0,10,0,0"
                               IsVisible="{Binding Photos.Count, Converter={StaticResource IntToBoolInvertedConverter}}"/>
                    </StackLayout>
                </Frame>
            </StackLayout>

            <!-- Notes - Only show if job type has notes enabled -->
            <StackLayout x:Name="NotesSection" IsVisible="False">
                <Label Text="Notes" Style="{StaticResource SubHeadline}"/>
                <Editor x:Name="NotesEditor" Placeholder="Additional notes" 
                        Text="{Binding Job.Notes}" HeightRequest="80"/>
            </StackLayout>

            <!-- Urgent Flag - Only show if job type has urgent flag enabled -->
            <StackLayout x:Name="UrgentSection" IsVisible="False" Orientation="Horizontal">
                <CheckBox x:Name="UrgentCheckBox" IsChecked="{Binding Job.IsUrgent}"/>
                <Label Text="Mark as urgent" VerticalOptions="Center" Margin="10,0,0,0"/>
            </StackLayout>

            <!-- Custom Fields - Only show if job type has custom fields -->
            <StackLayout x:Name="CustomFieldsSection" IsVisible="False">
                <Label Text="Custom Fields" Style="{StaticResource SubHeadline}"/>
                <CollectionView x:Name="CustomFieldsCollectionView" HeightRequest="200">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Margin="5" Padding="10" CornerRadius="5" BackgroundColor="White" HasShadow="True">
                                <StackLayout>
                                    <Label Text="{Binding Name}" FontAttributes="Bold"/>
                                    <Label Text="{Binding Type, StringFormat='Type: {0}'}" 
                                           TextColor="Gray" 
                                           FontSize="12"/>
                                    
                                    <!-- Text Field -->
                                    <Entry Placeholder="{Binding Name}" 
                                           Text="{Binding DefaultValue}"
                                           IsVisible="{Binding Type, Converter={StaticResource StringToBoolConverter}, ConverterParameter='text'}"
                                           Margin="0,5,0,0"/>
                                    
                                    <!-- Number Field -->
                                    <Entry Placeholder="{Binding Name}" 
                                           Text="{Binding DefaultValue}"
                                           Keyboard="Numeric"
                                           IsVisible="{Binding Type, Converter={StaticResource StringToBoolConverter}, ConverterParameter='number'}"
                                           Margin="0,5,0,0"/>
                                    
                                    <!-- Date Field -->
                                    <DatePicker Date="{Binding DefaultValue, Converter={StaticResource StringToDateConverter}}"
                                               IsVisible="{Binding Type, Converter={StaticResource StringToBoolConverter}, ConverterParameter='date'}"
                                               Margin="0,5,0,0"/>
                                    
                                    <!-- Boolean Field -->
                                    <StackLayout Orientation="Horizontal" 
                                               IsVisible="{Binding Type, Converter={StaticResource StringToBoolConverter}, ConverterParameter='boolean'}"
                                               Margin="0,5,0,0">
                                        <CheckBox IsChecked="{Binding DefaultValue, Converter={StaticResource StringToBoolConverter}}"/>
                                        <Label Text="{Binding Name}" VerticalOptions="Center" Margin="10,0,0,0"/>
                                    </StackLayout>
                                </StackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </StackLayout>

            <!-- Buttons -->
            <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Margin="0,20,0,0">
                <Button Text="Save" 
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        WidthRequest="120"
                        Margin="10,0"
                        Clicked="OnSaveClicked"/>
                <Button Text="Cancel" 
                        BackgroundColor="Gray"
                        TextColor="White"
                        WidthRequest="120"
                        Margin="10,0"
                        Clicked="OnCancelClicked"/>
            </StackLayout>
        </StackLayout>
    </ScrollView>

</ContentPage> 